{
  "hash": "f57a16162753c58f9134411878fe9417",
  "result": {
    "markdown": "---\ntitle: \"אפיון תשלומים זהים או שונים\"\ndescription: |\n  קיטלוג לקוחות עם סטטוס תשלומים זהה או לפחות אחד שונה\nauthor: \"\"\ndate: \"2023-09-19\"\ntoc: true\ncategories: [בסיסי]\nimage: featured.png\ndraft: false\n---\n\n\n\n\n\n\nברוכים הבאים לתרגיל השני!\n\n## הדאטה\n\nבטבלה למטה ניתן לראות פירוט תשלומים של יוזרים:\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 10 *\nFROM payments_ag_2;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Displaying records 1 - 10\n\n| user_id|date       |status  | amount|\n|-------:|:----------|:-------|------:|\n|       1|2023-06-01 |Load    |    234|\n|       1|2023-06-14 |Cancel  |     42|\n|       1|2023-06-16 |Load    |     52|\n|       1|2023-06-22 |Load    |      6|\n|       1|2023-06-23 |Load    |     36|\n|       1|2023-06-24 |Pending |     74|\n|       2|2023-06-03 |Load    |     58|\n|       2|2023-06-05 |Load    |     33|\n|       2|2023-06-09 |Load    |     65|\n|       2|2023-06-10 |Load    |     74|\n\n</div>\n:::\n\n\n\n## שאלה\n\n עבור כל יוזר החזר טבלה עם מספר התשלומים שהוא קיבל, עמודה המציינת האם כל התשלומים שהוא קיבל הם עם סטטוס 'Load' (1 כל התשלומים עם הסטטוס הזה, 0 לא), האם מספר התשלומים שנטענו היה גדול ממספר התשלומים שבוטלו (1 כן, 0 לא) והאם יש לו *לפחות תשלום אחד* שהוא 'Pending' (1 כן, 0 לא)\n\n\n**בהצלחה!**\n\n## יצירת הטבלה\n\n\n\n::: {.cell}\n\n```{.r .cell-code style=\"max-height: 200px;overflow: scroll;\"}\nDROP table if exists payments_ag_2;\n\n\nCREATE TABLE payments_ag_2\n    ([user_id] int, [date] date, [status] varchar(7), [amount] int)\n;\n    \nINSERT INTO payments_ag_2\n    ([user_id], [date], [status], [amount])\nVALUES\n    (1, '2023-06-01', 'Load', 234),\n    (1, '2023-06-14', 'Cancel', 42),\n    (1, '2023-06-16', 'Load', 52),\n    (1, '2023-06-22', 'Load', 6),\n    (1, '2023-06-23', 'Load', 36),\n    (1, '2023-06-24', 'Pending', 74),\n    (2, '2023-06-03', 'Load', 58),\n    (2, '2023-06-05', 'Load', 33),\n    (2, '2023-06-09', 'Load', 65),\n    (2, '2023-06-10', 'Load', 74),\n    (2, '2023-06-14', 'Load', 98),\n    (2, '2023-06-18', 'Load', 14),\n    (3, '2023-06-01', 'Cancel', 52),\n    (3, '2023-06-04', 'Cancel', 5),\n    (3, '2023-06-07', 'Pending', 99),\n    (4, '2023-06-09', 'Load', 100),\n    (4, '2023-06-10', 'Cancel', 15),\n    (5, '2023-06-15', 'Load', 20),\n    (6, '2023-06-16', 'Pending', 21),\n    (6, '2023-06-16', 'Load', 42)\n;\n```\n:::\n\n\n\n\n## תשובה\n\n### סרטון הסבר\n\n\n{{< video https://youtu.be/rHzikQGAnAc >}}\n\n\n\n### פלט\n\n<details>\n<summary>הצג קוד</summary>\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT USER_ID,\n\tCOUNT(*) AS N_PAYMENTS,\n\tCASE WHEN SUM(CASE WHEN STATUS = 'LOAD' THEN 1 ELSE 0 END) = COUNT(*) THEN 1 ELSE 0 END AS ALL_LOADED,\n\tCASE WHEN COUNT(CASE WHEN STATUS = 'LOAD' THEN 1 END) > COUNT(CASE WHEN STATUS = 'CANCEL' THEN 1 END) THEN 1 ELSE 0 END AS more_loaded_than_failed,\n\tMAX(CASE WHEN STATUS = 'PENDING' THEN 1 ELSE 0 END) AS HAS_PENDING_PAYMENT\nFROM payments_ag_2\nGROUP BY USER_ID\n```\n:::\n\n\n\n</details>\n\n\n\n\n\n::: {.cell}\n<div class=\"knitsql-table\">\n\n\nTable: 6 records\n\n|USER_ID | N_PAYMENTS| ALL_LOADED| more_loaded_than_failed| HAS_PENDING_PAYMENT|\n|:-------|----------:|----------:|-----------------------:|-------------------:|\n|1       |          6|          0|                       1|                   1|\n|2       |          6|          1|                       1|                   0|\n|3       |          3|          0|                       0|                   1|\n|4       |          2|          0|                       0|                   0|\n|5       |          1|          1|                       1|                   0|\n|6       |          2|          0|                       1|                   1|\n\n</div>\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}