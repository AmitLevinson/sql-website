{
  "hash": "b58e6e8439dbe5326556b090b835854e",
  "result": {
    "markdown": "---\ntitle: \"שימוש במאונים\"\ndescription: |\n  שימוש במאונים להבנת פיזור הנתונים\nauthor: \"\"\ndate: \"2024-05-04\"\ntoc: true\ncategories: [בסיסי]\nimage: featured.png\ndraft: true\nfilters:\n  - interactive-sql\ndatabases:\n  - name: percentiles_q9\n    path: \"https://raw.githubusercontent.com/AmitLevinson/sql-website/main/questions/9-Percentiles/q9.sql\"\n    \n---\n\n\n\n\nברוכים הבאים לתרגיל התשיעי!  \n\nבתרגיל(ים) הבאים נתרגל קצת חישוב מאונים. למי שלא מכיר/משתמש, שווה להכניס מאונים/עשירונים/רבעונים לארגז הכלים כאמצעי לבחינה של פיזור הדאטה, בייחוד כשיש ערכים קיצוניים.\n\n## הדאטה\n\nטבלה ראשונה מכילה אינדיקציה האם הלקוח סגור או לא (0 לא סגור, 1 סגור):\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 5 * \nFROM users;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n|user_id |closed |\n|:-------|:------|\n|1       |0      |\n|2       |0      |\n|3       |0      |\n|4       |0      |\n|5       |0      |\n\n</div>\n:::\n\n\nטבלה שניה מכילה תשלומים של היוזרים השונים:\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 5 * \nFROM payments;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n| user_id| amount|\n|-------:|------:|\n|      15|    122|\n|      22|     76|\n|      24|     20|\n|      18|    285|\n|      15|     64|\n\n</div>\n:::\n\n\n\n## שאלה 1\n\nמצאו את התשלום החציוני של שתי קבוצות המשתמשים השונות -- אלה החסומים ואלה שאינם.\n\nשאלת בונוס: מה הממוצע של כל קבוצה? מתוך שני המדדים האלה, איך נניח שנראית התפלגות הסכומים של כל אחת מהקבוצות?\n\n## שאלה 2\n\nצרו טבלת מאונים לעמודת תשלומים (ללא קשר לקבוצות בשאלה הקודמת). כלומר, הציגו את התשלום במאון ה-1%, 2% $...$  100% בדרך שתיהיה נוחה לכם לפרשנות.\n\nשאלת בונוס: איך תפרשו את הערכים? מה זה אומר המאון ה-70%?\n\n\n## נסו בעצמכם\n\n### אונליין \n\n<mark>נסו בחלון טקסט למטה (SQLite):</mark>\n\n*שאלה ראשונה פחות ממולצת לפתירה כאן (SQLite) אלא ב-RDBMS שלכם*\n\n```{.sql .interactive .percentiles_q9}\n-- EDIT THIS QUERY:\nSELECT *\nFROM Payments\n-- LEFT JOIN Users using(user_id)\nLIMIT 10;\n\n-- Median:\n(SELECT amount\nFROM PAyments\nORDER BY amount\nLIMIT 1\nOFFSET (SELECT COUNT(*)\n        FROM Payments) / 2)\n\n```\n\n\n### נסו על המחשב שלכם\n\n<details>\n<summary>הצג קוד ליצירת טבלה</summary>\n\n\n::: {.cell}\n\n```{.sql .cell-code style=\"max-height: 250px;overflow: scroll;\"}\n\n```\n:::\n\n\n</details>\n\n## תשובות\n\n### סרטון הסבר\n\n\n\n{{< video https://youtu.be/grncXOd5fhE >}}\n\n\n\n\n### תשובה 1\n\n<details>\n\n<summary>הצג פתרון</summary>\n\n**T-SQL**\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT DISTINCT CLOSED,\nAVG(AMOUNT) OVER(Partition by Closed) as Average_Amount,\nPERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY amount) OVER(partition by closed) AS Median_amount\nFROM payments p\nLEFT JOIN Users u on p.user_id = u.user_id;\n\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 2 records\n\n|CLOSED | Average_Amount| Median_amount|\n|:------|--------------:|-------------:|\n|0      |             94|          64.5|\n|1      |            104|          68.5|\n\n</div>\n:::\n\n\n</details>\n\n\n### תשובה 2\n\n<details>\n\n<summary>הצג פתרון</summary>\n\n**T-SQL**, (מראה רק את ה-10 שורות הראשונות)\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nWITH AMOUNT_DIST AS (\nSELECT \nFLOOR (cume_dist() over (ORDER BY AMOUNT) * 100) AS PERCENTILE,\nAMOUNT\nFROM Payments\n)\n\nSELECT PERCENTILE,\n\tMAX(AMOUNT) AS HIGHEST_AMOUNT_FOR_PERCENTILE\nFROM AMOUNT_dist\nGROUP BY PERCENTILE\n```\n:::\n\n\n</details>\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}