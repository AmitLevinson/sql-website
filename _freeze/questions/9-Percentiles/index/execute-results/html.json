{
  "hash": "9c456674c9647c22a71e35aeecb4f3d9",
  "result": {
    "markdown": "---\ntitle: \"מציאת מאונים\"\ndescription: |\n  שימוש במאונים להבנת פיזור הנתונים\nauthor: \"\"\ndate: \"2024-12-27\"\ntoc: true\ncategories: [בסיסי]\nimage: featured.png\ndraft: false\nfilters:\n  - interactive-sql\ndatabases:\n  - name: percentiles_q9\n    path: \"https://raw.githubusercontent.com/AmitLevinson/sql-website/main/questions/9-Percentiles/q9.sql\"\n    \n---\n\n\n\n\nברוכים הבאים לתרגיל התשיעי!  \n\nבתרגיל(ים) הבאים נתרגל קצת חישוב מאונים. למי שלא מכיר/משתמש, שווה להכניס מאונים/עשירונים/רבעונים לארגז הכלים כאמצעי לבחינה של פיזור הדאטה, בייחוד כשיש ערכים קיצוניים.\n\n## הדאטה\n\nטבלה ראשונה מכילה אינדיקציה האם הלקוח סגור או לא (0 לא סגור, 1 סגור):\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 5 * \nFROM users_9;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n|user_id |closed |\n|:-------|:------|\n|1       |0      |\n|2       |0      |\n|3       |0      |\n|4       |0      |\n|5       |0      |\n\n</div>\n:::\n\n\nטבלה שניה מכילה תשלומים של היוזרים השונים:\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 5 * \nFROM payments_9;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n| user_id| amount|\n|-------:|------:|\n|      15|    122|\n|      22|     76|\n|      24|     20|\n|      18|    285|\n|      15|     64|\n\n</div>\n:::\n\n\n\n## שאלה 1\n\nמצאו את התשלום החציוני של שתי קבוצות המשתמשים השונות -- אלה החסומים ואלה שאינם.\n\nשאלת בונוס: מה הממוצע של כל קבוצה? מתוך שני המדדים האלה, איך נניח שנראית התפלגות הסכומים של כל אחת מהקבוצות?\n\n## שאלה 2\n\n\nללא קשר לקבוצות בשאלה הקודמת, צרו טבלת מאונים לעמודת תשלומים. כלומר, הציגו את התשלום הגבוה ביותר במאון ה-1%, 2% $...$  100% בדרך שתיהיה נוחה לכם לפרשנות. אין צורך ליצור כל מאון מ-1 עד 100 אם הערכים זהים במאונים עוקבים.\n\n\nשאלת בונוס: איך תפרשו את הערכים? מה זה אומר המאון ה-70%?\n\n\n## נסו בעצמכם\n\n### אונליין \n\n<mark>נסו בחלון טקסט למטה (SQLite):</mark>\n\n**שאלה ראשונה פחות ממולצת לפתירה כאן (SQLite) אלא ב-RDBMS שלכם**\n\n```{.sql .interactive .percentiles_q9}\n-- EDIT THIS QUERY:\nSELECT *\nFROM payments_9\n-- LEFT JOIN users_9 using(user_id)\nLIMIT 10;\n\n\n```\n\n\n### נסו על המחשב שלכם\n\n<details>\n<summary>הצג קוד ליצירת טבלה</summary>\n\n\n::: {.cell}\n\n```{.sql .cell-code style=\"max-height: 250px;overflow: scroll;\"}\nCREATE TABLE [users_9] (\n    [user_id]\tINT,\n    [closed]\tVARCHAR(512)\n);\n\nINSERT INTO [users_9] ([user_id], [closed]) VALUES\n\t('1', '0'),\n\t('2', '0'),\n\t('3', '0'),\n\t('4', '0'),\n\t('5', '0'),\n\t('6', '0'),\n\t('7', '0'),\n\t('8', '0'),\n\t('9', '1'),\n\t('10', '0'),\n\t('11', '1'),\n\t('12', '0'),\n\t('13', '1'),\n\t('14', '1'),\n\t('15', '0'),\n\t('16', '0'),\n\t('17', '0'),\n\t('18', '0'),\n\t('19', '1'),\n\t('20', '0'),\n\t('21', '0'),\n\t('22', '1'),\n\t('23', '0'),\n\t('24', '1'),\n\t('25', '0'),\n\t('26', '0'),\n\t('27', '0'),\n\t('28', '0'),\n\t('29', '0'),\n\t('30', '0'),\n\t('31', '0'),\n\t('32', '0'),\n\t('33', '1'),\n\t('34', '0'),\n\t('35', '0'),\n\t('36', '0'),\n\t('37', '0'),\n\t('38', '0'),\n\t('39', '1'),\n\t('40', '0');\n\t\n\t\n-- Payments table\nCREATE TABLE [payments_9] (\n    [user_id]\tINT,\n    [amount]\tINT\n);\n\nINSERT INTO [payments_9] ([user_id], [amount]) VALUES\n\t('15', '122'),\n\t('22', '76'),\n\t('24', '20'),\n\t('18', '285'),\n\t('15', '64'),\n\t('17', '72'),\n\t('15', '57'),\n\t('34', '14'),\n\t('31', '180'),\n\t('10', '25'),\n\t('38', '38'),\n\t('5', '69'),\n\t('18', '64'),\n\t('40', '172'),\n\t('27', '218'),\n\t('28', '22'),\n\t('17', '18'),\n\t('22', '191'),\n\t('40', '61'),\n\t('13', '4'),\n\t('31', '3'),\n\t('20', '14'),\n\t('12', '33'),\n\t('38', '5'),\n\t('7', '108'),\n\t('38', '30'),\n\t('7', '37'),\n\t('25', '26'),\n\t('5', '75'),\n\t('5', '214'),\n\t('1', '55'),\n\t('37', '72'),\n\t('8', '14'),\n\t('32', '14'),\n\t('27', '30'),\n\t('12', '58'),\n\t('36', '66'),\n\t('1', '14'),\n\t('1', '122'),\n\t('24', '275'),\n\t('37', '214'),\n\t('27', '64'),\n\t('10', '75'),\n\t('13', '78'),\n\t('3', '30'),\n\t('33', '281'),\n\t('5', '76'),\n\t('30', '62'),\n\t('32', '122'),\n\t('13', '30'),\n\t('37', '56'),\n\t('16', '66'),\n\t('6', '76'),\n\t('39', '16'),\n\t('20', '214'),\n\t('14', '233'),\n\t('16', '256'),\n\t('31', '122'),\n\t('2', '3'),\n\t('20', '139'),\n\t('35', '122'),\n\t('19', '80'),\n\t('23', '49'),\n\t('26', '218'),\n\t('18', '33'),\n\t('28', '219'),\n\t('14', '208'),\n\t('1', '46'),\n\t('25', '281'),\n\t('28', '13'),\n\t('27', '56'),\n\t('36', '72'),\n\t('4', '78'),\n\t('30', '64'),\n\t('17', '64'),\n\t('26', '288'),\n\t('27', '22'),\n\t('14', '55'),\n\t('14', '172'),\n\t('26', '210'),\n\t('40', '57'),\n\t('37', '27'),\n\t('36', '46'),\n\t('23', '75'),\n\t('2', '64'),\n\t('20', '38'),\n\t('17', '275'),\n\t('18', '61'),\n\t('7', '208'),\n\t('30', '256'),\n\t('15', '105'),\n\t('10', '256'),\n\t('11', '38'),\n\t('11', '5'),\n\t('30', '219'),\n\t('38', '219'),\n\t('13', '56'),\n\t('37', '262'),\n\t('32', '45'),\n\t('25', '14'),\n\t('20', '105'),\n\t('17', '38'),\n\t('5', '55'),\n\t('20', '26'),\n\t('4', '4'),\n\t('25', '18'),\n\t('26', '122'),\n\t('21', '72'),\n\t('11', '23'),\n\t('4', '288'),\n\t('34', '33'),\n\t('18', '22'),\n\t('10', '22'),\n\t('17', '61'),\n\t('28', '56'),\n\t('12', '122'),\n\t('8', '4'),\n\t('26', '13'),\n\t('7', '16'),\n\t('30', '219'),\n\t('15', '131'),\n\t('22', '83'),\n\t('24', '28'),\n\t('18', '287'),\n\t('15', '73'),\n\t('17', '72'),\n\t('15', '65'),\n\t('34', '17'),\n\t('31', '187'),\n\t('10', '28'),\n\t('38', '42'),\n\t('5', '75'),\n\t('18', '65'),\n\t('40', '173'),\n\t('27', '219'),\n\t('28', '27'),\n\t('17', '25'),\n\t('22', '199'),\n\t('40', '67'),\n\t('13', '9'),\n\t('31', '8'),\n\t('20', '18'),\n\t('12', '33'),\n\t('38', '10'),\n\t('7', '112'),\n\t('38', '38'),\n\t('7', '37'),\n\t('25', '27'),\n\t('5', '78'),\n\t('5', '223'),\n\t('1', '63'),\n\t('37', '80'),\n\t('8', '21'),\n\t('32', '20'),\n\t('27', '33'),\n\t('12', '59'),\n\t('36', '68'),\n\t('1', '19'),\n\t('1', '130'),\n\t('24', '284'),\n\t('37', '219'),\n\t('27', '71'),\n\t('10', '77'),\n\t('13', '78'),\n\t('3', '37'),\n\t('33', '284'),\n\t('5', '84'),\n\t('30', '71'),\n\t('32', '130'),\n\t('13', '38'),\n\t('37', '61'),\n\t('16', '70'),\n\t('6', '81'),\n\t('39', '19'),\n\t('20', '215'),\n\t('14', '241'),\n\t('16', '263'),\n\t('31', '128'),\n\t('2', '11'),\n\t('20', '141'),\n\t('35', '131'),\n\t('19', '81'),\n\t('23', '51'),\n\t('26', '218'),\n\t('18', '38'),\n\t('28', '220'),\n\t('14', '217'),\n\t('1', '47'),\n\t('25', '281'),\n\t('28', '15'),\n\t('27', '57'),\n\t('36', '75'),\n\t('4', '81'),\n\t('30', '66'),\n\t('17', '67'),\n\t('26', '288'),\n\t('27', '22'),\n\t('14', '59'),\n\t('14', '174'),\n\t('26', '219'),\n\t('40', '59'),\n\t('37', '35'),\n\t('36', '54'),\n\t('23', '76'),\n\t('2', '65'),\n\t('20', '44'),\n\t('17', '282'),\n\t('18', '61'),\n\t('7', '211'),\n\t('30', '264'),\n\t('15', '109'),\n\t('10', '263'),\n\t('11', '40'),\n\t('11', '6'),\n\t('30', '224'),\n\t('38', '226'),\n\t('13', '61'),\n\t('37', '270'),\n\t('32', '47'),\n\t('25', '23'),\n\t('20', '112'),\n\t('17', '43'),\n\t('5', '63'),\n\t('20', '32'),\n\t('4', '5'),\n\t('25', '21'),\n\t('26', '129'),\n\t('21', '73'),\n\t('11', '29'),\n\t('4', '297'),\n\t('34', '42'),\n\t('18', '26'),\n\t('10', '23'),\n\t('17', '68'),\n\t('28', '58'),\n\t('12', '124'),\n\t('8', '11'),\n\t('26', '17'),\n\t('7', '23'),\n\t('30', '228');\n\n```\n:::\n\n\n</details>\n\n## תשובות\n\n### סרטון הסבר\n\n{{ < video https://youtu.be/iZZ0Bw4ZjFM > }}\n\n### תשובה 1\n\n<details>\n\n<summary>הצג פתרון</summary>\n\n**T-SQL**\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT DISTINCT CLOSED,\nAVG(AMOUNT) OVER(Partition by Closed) as Average_Amount,\nPERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY amount) OVER(partition by closed) AS Median_amount\nFROM payments_9 p\nLEFT JOIN users_9 u on p.user_id = u.user_id;\n\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 2 records\n\n|CLOSED | Average_Amount| Median_amount|\n|:------|--------------:|-------------:|\n|0      |             94|          64.5|\n|1      |            104|          68.5|\n\n</div>\n:::\n\n\n</details>\n\n\n### תשובה 2\n\n<details>\n\n<summary>הצג פתרון</summary>\n\n**T-SQL**, (מראה רק את ה-10 שורות הראשונות)\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nWITH AMOUNT_DIST AS (\nSELECT \nCAST (cume_dist() over (ORDER BY AMOUNT) * 100 as int) AS PERCENTILE,\nAMOUNT\nFROM payments_9\n)\n\nSELECT PERCENTILE,\n\tMAX(AMOUNT) AS HIGHEST_AMOUNT_FOR_PERCENTILE\nFROM AMOUNT_dist\nGROUP BY PERCENTILE\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Displaying records 1 - 10\n\n| PERCENTILE| HIGHEST_AMOUNT_FOR_PERCENTILE|\n|----------:|-----------------------------:|\n|          0|                             3|\n|          2|                             4|\n|          3|                             6|\n|          4|                             9|\n|          5|                            11|\n|          6|                            13|\n|          9|                            15|\n|         10|                            16|\n|         11|                            17|\n|         12|                            18|\n\n</div>\n:::\n\n\n</details>\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}