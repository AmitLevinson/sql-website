{
  "hash": "b4fd1afa573e0212a9b42328e03fe72f",
  "result": {
    "markdown": "---\ntitle: \"זיהוי רצפים בהתחברות\"\ndescription: |\n  תרגול זיהוי פעולות רצופות\nauthor: \"\"\ndate: \"2023-09-05\"\ntoc: true\ncategories: [מתקדם]\nimage: featured.png\ndraft: false\n---\n\n\n\n\n\n\nברוכים הבאים לתרגיל הראשון בניוזלטר!\n\n## הדאטה\n\nהתרגיל יורכב משתי שאלות. בטבלה למטה ניתן לראות ניסיונות התחברות של יוזרים (success / fail) בנקודות זמן שונות.\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 10 * FROM LOGINS;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Displaying records 1 - 10\n\n| user_id|login_date |login   |\n|-------:|:----------|:-------|\n|       3|2022-08-12 |success |\n|       4|2022-08-26 |success |\n|       5|2022-07-17 |success |\n|       5|2022-11-02 |success |\n|       2|2023-06-07 |success |\n|       1|2023-05-07 |success |\n|       5|2023-04-28 |fail    |\n|       3|2023-04-26 |success |\n|       2|2023-02-05 |success |\n|       5|2022-12-22 |fail    |\n\n</div>\n:::\n\n\n\n## שאלות\n\n### שאלה 1\nעבור כל יוזר החזירו את רצף הצלחות התחברות הגדול ביותר.\n\nלדוג', עבור יוזר 2 עם ההתחברויות הבאות:\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-84160393f1d216174077\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-84160393f1d216174077\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\"],[\"success\",\"fail\",\"fail\",\"fail\",\"success\",\"fail\",\"success\",\"success\",\"success\",\"success\",\"success\",\"success\",\"fail\",\"success\",\"fail\",\"fail\",\"success\",\"success\",\"success\",\"success\",\"success\",\"success\"],[\"2022-07-03\",\"2022-07-17\",\"2022-08-06\",\"2022-09-17\",\"2022-10-02\",\"2022-10-05\",\"2022-10-22\",\"2022-10-27\",\"2022-11-14\",\"2022-11-27\",\"2022-12-17\",\"2023-01-09\",\"2023-01-30\",\"2023-02-05\",\"2023-02-20\",\"2023-02-23\",\"2023-02-24\",\"2023-04-02\",\"2023-04-17\",\"2023-04-27\",\"2023-05-22\",\"2023-06-07\"],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>login<\\/th>\\n      <th>login_date<\\/th>\\n      <th>user_id<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":3},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n\nנחזיר את הרשומה הבאה (שכן ניתן לראות למעלה שיש לו רצף של 6 הצלחות התחברות כמספר הגבוה ביותר):    \n\n\n::: {.cell}\n<div class=\"knitsql-table\">\n\n\nTable: 1 records\n\n| user_id| most_consecutive_logins|\n|-------:|-----------------------:|\n|       2|                       6|\n\n</div>\n:::\n\n\n\n### שאלה 2\n\nברגע שיוזרים נכשלים בהתחברות שלוש פעמים באופן רצוף החשבון שלהם ננעל. עבור כל יוזר עם שלוש כשלונות התחברות או יותר, החזירו את\nהתאריך (login_date) בו הוא קיבל *לראשונה* את הכשלון השלישי באופן רצוף.\n\nלדוג', עבור יוזר 1:\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 7 * FROM LOGINS\nwhere user_id = 1\norder by login_date;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 7 records\n\n| user_id|login_date |login   |\n|-------:|:----------|:-------|\n|       1|2022-07-09 |fail    |\n|       1|2022-07-15 |fail    |\n|       1|2022-07-20 |success |\n|       1|2022-08-12 |fail    |\n|       1|2022-08-15 |fail    |\n|       1|2022-08-22 |fail    |\n|       1|2022-09-13 |success |\n\n</div>\n:::\n\n\nניתן לראות שבניסיון התחברות ה-4, 5, ו-6 הוא נכשל לראשונה לפחות שלוש פעמים. לכן נחזיר עבורו את הערך 2022-08-22.\n\n\n::: {.cell}\n<div class=\"knitsql-table\">\n\n\nTable: 1 records\n\n| user_id|FIRST_3rd_failed_login |\n|-------:|:----------------------|\n|       1|2022-08-22             |\n\n</div>\n:::\n\n\n## יצירת הטבלה\n\nמוזמנים להשתמש בקוד הבא ליצירת טבלה (יש סימן להעתקה בצד ימין למעלה של המלבן כשמעבירים את העכבר מעליו):\n\n\n\n::: {.cell}\n\n```{.sql .cell-code style=\"max-height: 200px;overflow: scroll;\"}\n\n--drop table if exists logins; /* Drop with caution */\n\ncreate table logins (\n\tuser_id INT,\n\tlogin_date DATE,\n\tlogin VARCHAR(50)\n);\ninsert into logins (user_id, login_date, login) values (3, '8/12/2022', 'success');\ninsert into logins (user_id, login_date, login) values (4, '8/26/2022', 'success');\ninsert into logins (user_id, login_date, login) values (5, '7/17/2022', 'success');\ninsert into logins (user_id, login_date, login) values (5, '11/2/2022', 'success');\ninsert into logins (user_id, login_date, login) values (2, '6/7/2023', 'success');\ninsert into logins (user_id, login_date, login) values (1, '5/7/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '4/28/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '4/26/2023', 'success');\ninsert into logins (user_id, login_date, login) values (2, '2/5/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '12/22/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '4/22/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '6/29/2023', 'success');\ninsert into logins (user_id, login_date, login) values (3, '4/19/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '4/6/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '4/16/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '5/22/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '3/10/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '6/23/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '1/18/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '4/27/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '11/6/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '11/18/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '9/17/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '11/14/2022', 'success');\ninsert into logins (user_id, login_date, login) values (3, '7/23/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '9/13/2022', 'success');\ninsert into logins (user_id, login_date, login) values (2, '7/3/2022', 'success');\ninsert into logins (user_id, login_date, login) values (1, '12/9/2022', 'success');\ninsert into logins (user_id, login_date, login) values (4, '4/3/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '10/11/2022', 'success');\ninsert into logins (user_id, login_date, login) values (4, '3/16/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '1/10/2023', 'success');\ninsert into logins (user_id, login_date, login) values (3, '12/3/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '7/2/2022', 'success');\ninsert into logins (user_id, login_date, login) values (1, '10/11/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '2/24/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '9/11/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '4/11/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '6/3/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '1/30/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '10/21/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '7/9/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '8/12/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '5/30/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '8/11/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '10/22/2022', 'success');\ninsert into logins (user_id, login_date, login) values (3, '1/6/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '11/10/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '4/2/2023', 'success');\ninsert into logins (user_id, login_date, login) values (2, '7/17/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '8/6/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '1/11/2023', 'success');\ninsert into logins (user_id, login_date, login) values (2, '2/20/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '1/9/2023', 'success');\ninsert into logins (user_id, login_date, login) values (3, '1/3/2023', 'success');\ninsert into logins (user_id, login_date, login) values (2, '4/17/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '3/7/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '6/26/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '6/30/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '2/1/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '3/26/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '11/13/2022', 'success');\ninsert into logins (user_id, login_date, login) values (5, '8/11/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '1/30/2023', 'success');\ninsert into logins (user_id, login_date, login) values (3, '12/2/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '9/27/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '10/26/2022', 'success');\ninsert into logins (user_id, login_date, login) values (2, '2/23/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '12/25/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '8/22/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '5/27/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '8/17/2022', 'success');\ninsert into logins (user_id, login_date, login) values (2, '10/2/2022', 'success');\ninsert into logins (user_id, login_date, login) values (1, '7/15/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '2/6/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '6/5/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (1, '8/15/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '8/3/2022', 'success');\ninsert into logins (user_id, login_date, login) values (4, '12/17/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '9/11/2022', 'success');\ninsert into logins (user_id, login_date, login) values (5, '7/6/2022', 'success');\ninsert into logins (user_id, login_date, login) values (5, '1/14/2023', 'success');\ninsert into logins (user_id, login_date, login) values (1, '11/4/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '11/18/2022', 'success');\ninsert into logins (user_id, login_date, login) values (2, '12/17/2022', 'success');\ninsert into logins (user_id, login_date, login) values (4, '5/2/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '8/14/2022', 'success');\ninsert into logins (user_id, login_date, login) values (1, '7/20/2022', 'success');\ninsert into logins (user_id, login_date, login) values (2, '10/27/2022', 'success');\ninsert into logins (user_id, login_date, login) values (2, '2/24/2023', 'success');\ninsert into logins (user_id, login_date, login) values (5, '9/17/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '10/5/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (5, '1/12/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '4/30/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '6/14/2023', 'success');\ninsert into logins (user_id, login_date, login) values (2, '10/5/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (3, '7/24/2022', 'fail');\ninsert into logins (user_id, login_date, login) values (4, '6/3/2023', 'fail');\ninsert into logins (user_id, login_date, login) values (2, '11/27/2022', 'success');\ninsert into logins (user_id, login_date, login) values (1, '3/15/2023', 'success');\n\n```\n:::\n\n\n**בהצלחה!**\n\n\n## תשובות\n\n### סרטון הסבר\n\n\n{{< video https://www.youtube.com/watch?v=SjOp7psbk2o >}}\n\n\n\n\n### 1.\n\n<details>\n<summary>הצג קוד</summary>\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nWITH GROUPS AS (\n  SELECT user_id,\n  login,\n  login_date,\n    ROW_NUMBER() OVER(PARTITION BY user_id order by login_date) - ROW_NUMBER() OVER(PARTITION BY user_id, LOGIN order by login_date asc) as grp\n  FROM LOGINS\n),\n\nlogin_ranks as (\n  SELECT user_id,\n    COUNT(*) AS most_consecutive_logins,\n    ROW_NUMBER() OVER(partition by user_id ORDER BY count(*) desc) as rnk\n  FROM GROUPS\n  where login = 'success'\n  GROUP BY user_id,\n    GRP\n  )\n  \nSELECT user_id,\n  most_consecutive_logins\nFROM LOGIN_RANKS\nWHERE RNK = 1\n```\n:::\n\n\n\n</details>\n\n\n::: {.cell}\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n|user_id | most_consecutive_logins|\n|:-------|-----------------------:|\n|1       |                       1|\n|2       |                       6|\n|3       |                       2|\n|4       |                       1|\n|5       |                       2|\n\n</div>\n:::\n\n\n\n\n### 2.\n\n<details>\n<summary>הצג קוד</summary>\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nWITH GROUPS AS (\n  SELECT user_id,\n  login,\n  login_date,\n    ROW_NUMBER() OVER(PARTITION BY user_id order by login_date) - ROW_NUMBER() OVER(PARTITION BY user_id, LOGIN order by login_date asc) as grp\n  FROM LOGINS\n),\n\ngrp_stamps as (\nSELECT user_id,\n  login_date,\n  rn_within_group = ROW_NUMBER() OVER(PARTITION BY user_id, GRP order by grp, login_date)\nFROM GROUPS\nwhere login = 'fail'\n)\n\nselect user_id, \n  min(login_date) AS FIRST_3rd_failed_login\nfrom grp_stamps\nWHERE rn_within_group = 3\nGROUP BY user_id\n```\n:::\n\n\n</details>\n\n\n::: {.cell}\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n|user_id |FIRST_3rd_failed_login |\n|:-------|:----------------------|\n|1       |2022-08-22             |\n|2       |2022-09-17             |\n|3       |2023-04-19             |\n|4       |2022-12-25             |\n|5       |2022-10-05             |\n\n</div>\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\r\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/datatables-binding-0.28/datatables.js\"></script>\r\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\r\n<link href=\"../../site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\r\n<link href=\"../../site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js\"></script>\r\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}