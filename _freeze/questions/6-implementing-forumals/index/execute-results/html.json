{
  "hash": "1db90b406a865e82f2304f00af0559ff",
  "result": {
    "markdown": "---\ntitle: \"מימוש נוסחאות סטטיסטיות\"\ndescription: |\n  תרגום נוסחה סטטיסטית לקוד SQL\nauthor: \"\"\ndate: \"2023-12-05\"\ntoc: true\ncategories: [בסיסי]\nimage: featured.png\ndraft: true\n---\n\n\n\n\nברוכים הבאים לתרגיל השישי!\n\n## הדאטה\n\nהתרגיל מורכב מטבלת פריטי כלי בית והסכום שבו הם נמכרו:\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT TOP 5 * \nFROM LOGS_Q5\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n|user_id |log_date   |log_text                                                                                                                        |\n|:-------|:----------|:-------------------------------------------------------------------------------------------------------------------------------|\n|1       |2023-09-20 |user 1 registered in 2018. Closure reason: Duplicate account.                                                                   |\n|2       |2023-04-01 |user 2 registered in 2022. Closure reason: Fraudulent behaviour.                                                                |\n|3       |2023-06-26 |user 3 registered in 2016. Closure reason: Unsupported activity. Current status: open. Account has been re-opened               |\n|4       |2023-06-21 |user 4 registered in 2016. Closure reason: Did not provide relevant documents. Current status: open. Account has been re-opened |\n|5       |2023-02-04 |user 5 registered in 2017. Closure reason: Unsupported activity.                                                                |\n\n</div>\n:::\n\n\n## שאלה 1\n\nהינכם מתבקשים למדוד את מקדם השונות ([Coefficient of Variation](https://en.wikipedia.org/wiki/Coefficient_of_variation)) של כל קטגוריה מפריטי הבית.\n\nהנוסחה למדידת אותו מקדם היא כדלקמן:\n\n$$\nCV = \\frac{\\sigma}{\\mu}\n$$\n\nכלומר, חלוקת סטיית התקן של הקבוצה בממוצע שלה. יש למיין את הפלט בסדר יורד של עריך ה-CV; פריטים עם ערך נמוך יותר יופיעו ראשונים וכן הלאה.\n\n## שאלה 2\n\nהתבקשם 'לנרמל' את עמודת הסכום בדאטה כך שכל הערכים בכל קבוצה יהיו בטווח ערכים זהה של 0-100: הערך הכי גדול בכל קבוצה ימופה ל-100 ואילו הערך הקטן ביותר יהיה 0, וכך כל הערכים המקוריים ימופו לטווח הערכים ביניהם. \n\nכדי לנרמל את עמודת ה-Amount, השתמשו בנוסחה הבאה:\n\n$$\nZ_i = \\frac{X_i - min(x)}{max(x) - min(x)} * 100\n$$\nכאשר:  \n\n- $Z_i$: זה הערך $i$ המנורמל החדש  \n\n- $X_i$: הערך $i$ שעובר נרמול  \n\n- $min(x)$: הערך המינימלי במערך $X$  \n\n- $max(x)$: הערך המקסימלי במערך $X$ \n\n\n\n## יצירת הטבלה\n\n\n::: {.cell}\n\n```{.sql .cell-code style=\"max-height: 200px;overflow: scroll;\"}\n\nDROP TABLE IF EXISTS LOGS_Q5;\n\nCREATE TABLE LOGS_Q5\n    (user_id int, log_date datetime, log_text varchar(128))\n;\n    \nINSERT INTO LOGS_Q5\n    (user_id, log_date, log_text)\nVALUES\n    (1, '2023-09-20 00:00:00', 'user 1 registered in 2018. Closure reason: Duplicate account.'),\n    (2, '2023-04-01 00:00:00', 'user 2 registered in 2022. Closure reason: Fraudulent behaviour.'),\n    (3, '2023-06-26 00:00:00', 'user 3 registered in 2016. Closure reason: Unsupported activity. Current status: open. Account has been re-opened'),\n    (4, '2023-06-21 00:00:00', 'user 4 registered in 2016. Closure reason: Did not provide relevant documents. Current status: open. Account has been re-opened'),\n    (5, '2023-02-04 00:00:00', 'user 5 registered in 2017. Closure reason: Unsupported activity.'),\n    (6, '2023-03-09 00:00:00', 'user 6 registered in 2022. Closure reason: Fraudulent behaviour. Current status: open. Account has been re-opened'),\n    (7, '2023-01-17 00:00:00', 'user 7 registered in 2018. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (8, '2023-09-12 00:00:00', 'user 8 registered in 2019. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (9, '2023-01-17 00:00:00', 'user 9 registered in 2014. Closure reason: Duplicate account. Current status: account closed.'),\n    (10, '2023-09-17 00:00:00', 'user 10 registered in 2018. Closure reason: Requested to close. Current status: account closed.'),\n    (11, '2023-01-06 00:00:00', 'user 11 registered in 2014. Closure reason: Unsupported activity. Current status: open. Account has been re-opened'),\n    (12, '2023-05-28 00:00:00', 'user 12 registered in 2015. Closure reason: Requested to close.'),\n    (13, '2023-09-09 00:00:00', 'user 13 registered in 2015. Closure reason: Fraudulent behaviour.'),\n    (14, '2023-04-08 00:00:00', 'user 14 registered in 2015. Closure reason: Duplicate account. Current status: open.'),\n    (15, '2023-03-19 00:00:00', 'user 15 registered in 2018. Closure reason: Duplicate account.'),\n    (16, '2023-10-09 00:00:00', 'user 16 registered in 2022. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (17, '2023-05-19 00:00:00', 'user 17 registered in 2015. Closure reason: Fraudulent behaviour. Current status: open. Account has been re-opened'),\n    (18, '2023-01-22 00:00:00', 'user 18 registered in 2016. Closure reason: Unsupported activity. Current status: account closed.'),\n    (19, '2023-08-30 00:00:00', 'user 19 registered in 2022. Closure reason: Fraudulent behaviour.'),\n    (20, '2023-09-26 00:00:00', 'user 20 registered in 2016. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (21, '2023-04-20 00:00:00', 'user 21 registered in 2015. Closure reason: Did not provide relevant documents. Current status: account closed.'),\n    (22, '2023-05-02 00:00:00', 'user 22 registered in 2020. Closure reason: Duplicate account. Current status: account closed.'),\n    (23, '2023-04-18 00:00:00', 'user 23 registered in 2021. Closure reason: Duplicate account. Current status: account closed.'),\n    (24, '2023-07-27 00:00:00', 'user 24 registered in 2020. Closure reason: Requested to close.'),\n    (25, '2023-08-25 00:00:00', 'user 25 registered in 2020. Closure reason: Requested to close. Current status: open. Account has been re-opened'),\n    (26, '2023-07-22 00:00:00', 'user 26 registered in 2022. Closure reason: Fraudulent behaviour.'),\n    (27, '2023-01-28 00:00:00', 'user 27 registered in 2016. Closure reason: Unsupported activity. Current status: open.'),\n    (28, '2023-05-20 00:00:00', 'user 28 registered in 2017. Closure reason: Requested to close. Current status: open.'),\n    (29, '2023-09-10 00:00:00', 'user 29 registered in 2017. Closure reason: Unsupported activity.'),\n    (30, '2023-05-28 00:00:00', 'user 30 registered in 2019. Closure reason: Did not provide relevant documents. Current status: open. Account has been re-opened'),\n    (31, '2023-08-27 00:00:00', 'user 31 registered in 2018. Closure reason: Requested to close. Current status: account closed.'),\n    (32, '2023-01-08 00:00:00', 'user 32 registered in 2014. Closure reason: Fraudulent behaviour.'),\n    (33, '2023-07-20 00:00:00', 'user 33 registered in 2021. Closure reason: Unsupported activity. Current status: account closed.'),\n    (34, '2023-01-31 00:00:00', 'user 34 registered in 2016. Closure reason: Duplicate account. Current status: open.'),\n    (35, '2023-07-08 00:00:00', 'user 35 registered in 2019. Closure reason: Unsupported activity.'),\n    (36, '2023-07-31 00:00:00', 'user 36 registered in 2016. Closure reason: Requested to close. Current status: account closed.'),\n    (37, '2023-02-02 00:00:00', 'user 37 registered in 2019. Closure reason: Did not provide relevant documents. Current status: open.'),\n    (38, '2023-03-07 00:00:00', 'user 38 registered in 2016. Closure reason: Fraudulent behaviour.'),\n    (39, '2023-06-11 00:00:00', 'user 39 registered in 2017. Closure reason: Duplicate account. Current status: account closed.'),\n    (40, '2023-05-21 00:00:00', 'user 40 registered in 2014. Closure reason: Did not provide relevant documents. Current status: account closed.'),\n    (41, '2023-08-12 00:00:00', 'user 41 registered in 2020. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (42, '2023-09-09 00:00:00', 'user 42 registered in 2018. Closure reason: Duplicate account.'),\n    (43, '2023-05-26 00:00:00', 'user 43 registered in 2014. Closure reason: Did not provide relevant documents.'),\n    (44, '2023-03-06 00:00:00', 'user 44 registered in 2016. Closure reason: Duplicate account. Current status: account closed.'),\n    (45, '2023-08-07 00:00:00', 'user 45 registered in 2016. Closure reason: Did not provide relevant documents. Current status: account closed.'),\n    (46, '2023-10-04 00:00:00', 'user 46 registered in 2017. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (47, '2023-01-28 00:00:00', 'user 47 registered in 2019. Closure reason: Fraudulent behaviour. Current status: open. Account has been re-opened'),\n    (48, '2023-01-17 00:00:00', 'user 48 registered in 2021. Closure reason: Did not provide relevant documents. Current status: open. Account has been re-opened'),\n    (49, '2023-02-26 00:00:00', 'user 49 registered in 2015. Closure reason: Unsupported activity. Current status: account closed.'),\n    (50, '2023-06-19 00:00:00', 'user 50 registered in 2015. Closure reason: Duplicate account.'),\n    (51, '2023-01-13 00:00:00', 'user 51 registered in 2015. Closure reason: Duplicate account. Current status: open.'),\n    (52, '2023-03-02 00:00:00', 'user 52 registered in 2017. Closure reason: Did not provide relevant documents.'),\n    (53, '2023-01-14 00:00:00', 'user 53 registered in 2014. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (54, '2023-09-13 00:00:00', 'user 54 registered in 2018. Closure reason: Requested to close. Current status: open.'),\n    (55, '2023-07-17 00:00:00', 'user 55 registered in 2017. Closure reason: Requested to close. Current status: open. Account has been re-opened'),\n    (56, '2023-10-12 00:00:00', 'user 56 registered in 2018. Closure reason: Did not provide relevant documents. Current status: account closed.'),\n    (57, '2023-09-27 00:00:00', 'user 57 registered in 2016. Closure reason: Duplicate account. Current status: open.'),\n    (58, '2023-02-15 00:00:00', 'user 58 registered in 2017. Closure reason: Did not provide relevant documents. Current status: open.'),\n    (59, '2023-10-26 00:00:00', 'user 59 registered in 2021. Closure reason: Duplicate account. Current status: account closed.'),\n    (60, '2023-07-10 00:00:00', 'user 60 registered in 2020. Closure reason: Unsupported activity. Current status: open.'),\n    (61, '2023-09-09 00:00:00', 'user 61 registered in 2020. Closure reason: Fraudulent behaviour.'),\n    (62, '2023-07-12 00:00:00', 'user 62 registered in 2017. Closure reason: Fraudulent behaviour.'),\n    (63, '2023-01-11 00:00:00', 'user 63 registered in 2017. Closure reason: Duplicate account. Current status: open.'),\n    (64, '2023-02-27 00:00:00', 'user 64 registered in 2020. Closure reason: Unsupported activity. Current status: open.'),\n    (65, '2023-07-12 00:00:00', 'user 65 registered in 2021. Closure reason: Did not provide relevant documents.'),\n    (66, '2023-03-09 00:00:00', 'user 66 registered in 2014. Closure reason: Requested to close. Current status: open. Account has been re-opened'),\n    (67, '2023-10-31 00:00:00', 'user 67 registered in 2022. Closure reason: Duplicate account.'),\n    (68, '2023-06-26 00:00:00', 'user 68 registered in 2018. Closure reason: Duplicate account. Current status: open.'),\n    (69, '2023-04-22 00:00:00', 'user 69 registered in 2022. Closure reason: Did not provide relevant documents. Current status: open.'),\n    (70, '2023-09-22 00:00:00', 'user 70 registered in 2015. Closure reason: Unsupported activity.'),\n    (71, '2023-10-04 00:00:00', 'user 71 registered in 2016. Closure reason: Duplicate account. Current status: open.'),\n    (72, '2023-10-31 00:00:00', 'user 72 registered in 2020. Closure reason: Unsupported activity.'),\n    (73, '2023-04-20 00:00:00', 'user 73 registered in 2020. Closure reason: Did not provide relevant documents. Current status: open.'),\n    (74, '2023-10-15 00:00:00', 'user 74 registered in 2017. Closure reason: Duplicate account. Current status: account closed.'),\n    (75, '2023-07-23 00:00:00', 'user 75 registered in 2021. Closure reason: Fraudulent behaviour.'),\n    (76, '2023-03-15 00:00:00', 'user 76 registered in 2017. Closure reason: Duplicate account.'),\n    (77, '2023-10-27 00:00:00', 'user 77 registered in 2019. Closure reason: Requested to close. Current status: account closed.'),\n    (78, '2023-02-03 00:00:00', 'user 78 registered in 2022. Closure reason: Requested to close. Current status: account closed.'),\n    (79, '2023-08-09 00:00:00', 'user 79 registered in 2019. Closure reason: Duplicate account.'),\n    (80, '2023-05-19 00:00:00', 'user 80 registered in 2021. Closure reason: Requested to close.'),\n    (81, '2023-01-02 00:00:00', 'user 81 registered in 2020. Closure reason: Duplicate account. Current status: open. Account has been re-opened'),\n    (82, '2023-08-08 00:00:00', 'user 82 registered in 2020. Closure reason: Duplicate account. Current status: open. Account has been re-opened'),\n    (83, '2023-04-25 00:00:00', 'user 83 registered in 2021. Closure reason: Duplicate account.'),\n    (84, '2023-04-24 00:00:00', 'user 84 registered in 2020. Closure reason: Duplicate account.'),\n    (85, '2023-01-15 00:00:00', 'user 85 registered in 2021. Closure reason: Fraudulent behaviour.'),\n    (86, '2023-01-11 00:00:00', 'user 86 registered in 2020. Closure reason: Duplicate account. Current status: account closed.'),\n    (87, '2023-08-08 00:00:00', 'user 87 registered in 2021. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (88, '2023-01-27 00:00:00', 'user 88 registered in 2015. Closure reason: Unsupported activity.'),\n    (89, '2023-08-31 00:00:00', 'user 89 registered in 2020. Closure reason: Unsupported activity. Current status: account closed.'),\n    (90, '2023-07-26 00:00:00', 'user 90 registered in 2021. Closure reason: Duplicate account. Current status: account closed.'),\n    (91, '2023-07-10 00:00:00', 'user 91 registered in 2014. Closure reason: Unsupported activity. Current status: account closed.'),\n    (92, '2023-07-18 00:00:00', 'user 92 registered in 2017. Closure reason: Fraudulent behaviour. Current status: account closed.'),\n    (93, '2023-08-19 00:00:00', 'user 93 registered in 2021. Closure reason: Did not provide relevant documents. Current status: account closed.'),\n    (94, '2023-01-26 00:00:00', 'user 94 registered in 2015. Closure reason: Duplicate account.'),\n    (95, '2023-08-14 00:00:00', 'user 95 registered in 2019. Closure reason: Did not provide relevant documents. Current status: account closed.'),\n    (96, '2023-05-11 00:00:00', 'user 96 registered in 2022. Closure reason: Fraudulent behaviour.'),\n    (97, '2023-08-03 00:00:00', 'user 97 registered in 2020. Closure reason: Duplicate account. Current status: open. Account has been re-opened'),\n    (98, '2023-01-17 00:00:00', 'user 98 registered in 2017. Closure reason: Unsupported activity. Current status: open.'),\n    (99, '2023-10-08 00:00:00', 'user 99 registered in 2021. Closure reason: Did not provide relevant documents.'),\n    (100, '2023-10-18 00:00:00', 'user 100 registered in 2019. Closure reason: Duplicate account. Current status: open. Account has been re-opened')\n;\n\n```\n:::\n\n\n## תשובות\n\n### סרטון הסבר\n\n### תשובה 1\n\n<details>\n\n<summary>הצג פתרון</summary>\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT \t\n\tregistered_year = SUBSTRING(LOG_TEXT, CHARINDEX('registered in ', LOG_TEXT) + len('registered in '), 5),\n\tCOUNT(*) AS n\nFROM logs_q5\nGROUP BY SUBSTRING(LOG_TEXT, CHARINDEX('registered in ', LOG_TEXT) + len('registered in '), 5)\nORDER BY registered_year DESC;\n```\n:::\n\n\n</details>\n\n\n::: {.cell}\n\n:::\n\n\n### תשובה 2\n\n<details>\n\n<summary>הצג פתרון</summary>\n\n\n::: {.cell}\n\n```{.sql .cell-code}\n\nWITH reason_extracted as (\n\tSELECT\n\treason = REPLACE(\n\t\tSUBSTRING(\n\t\t\tlog_text,\n\t\t\tCHARINDEX('closure reason: ', log_text)\t+ LEN('closure reason: '),\n\t\t\tCASE\n\t\t\t\tWHEN CHARINDEX('Current status', log_text) = 0 THEN LEN(log_text)\n\t\t    ELSE CHARINDEX('Current status', log_text) - CHARINDEX('closure reason: ',log_text) - LEN('closure reason: ')\n\t\t\t\tEND),\n\t\t'.', '')\n\tFROM logs_q5\n)\n\nSELECT reason,\n\tCOUNT(*) AS n\nFROM reason_extracted\nGROUP BY reason\nORDER BY n desc\n\n```\n:::\n\n\n</details>\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}